# Гайд по SAL-аннотациям

## Что такое SAL-аннотации?

SAL (Semantic Annotation Language) - это формальный язык для описания контрактов компонентов прямо в коде через комментарии.

## Структура SAL-аннотаций

### Уровни контрактов

1. **Системные контракты** - гарантии системы в целом
2. **Компонентные контракты** - гарантии конкретного компонента
3. **Формальные контракты** - предусловия, постусловия, инварианты
4. **Бизнесовое обоснование** - зачем нужны контракты

## Формат SAL-аннотаций

```javascript
/**
 * === СИСТЕМНЫЕ КОНТРАКТЫ ===
 * @system_contract: Гарантия системы
 * @integration_contract: Как взаимодействует с другими
 * @consistency_model: Модель консистентности
 * @failure_policy: Политика обработки ошибок
 * @performance_contract: SLA производительности
 * 
 * === КОМПОНЕНТНЫЕ КОНТРАКТЫ ===
 * @component_contract: Основная гарантия компонента
 * @interface_contract: Гарантия API
 * @implementation_strategy: Стратегия реализации
 * 
 * === ФОРМАЛЬНЫЕ КОНТРАКТЫ ===
 * @requires: Предусловие (что должно быть истинно)
 * @ensures: Постусловие (что будет истинно после)
 * @invariant: Инвариант (что остается неизменным)
 * @modifies: Что изменяется
 * @throws: Какие исключения выбрасываются
 * 
 * === БИЗНЕСОВОЕ ОБОСНОВАНИЕ ===
 * @why_requires: Зачем нужно предусловие
 * @why_ensures: Зачем нужна гарантия
 * @why_invariant: Зачем поддерживать инвариант
 * @business_impact: Последствия нарушения
 * @stakeholder_value: Ценность для пользователя
 */
```

## Примеры

### Базовый класс с контрактами

```javascript
/**
 * StorageManager - Управление localStorage
 * 
 * === СИСТЕМНЫЕ КОНТРАКТЫ ===
 * @system_contract: Гарантирует персистентность данных между сессиями
 * @consistency_model: Strong consistency
 * @failure_policy: При QuotaExceededError показывает alert
 * 
 * === КОМПОНЕНТНЫЕ КОНТРАКТЫ ===
 * @component_contract: Предоставляет единый интерфейс для localStorage
 * 
 * === ФОРМАЛЬНЫЕ КОНТРАКТЫ ===
 * @requires: localStorage доступен в браузере
 * @ensures: Данные сохраняются и загружаются корректно
 * @invariant: storageKey всегда равен 'andlanceros'
 */
export class StorageManager {
  /**
   * Сохранение данных
   * @requires: data валиден для JSON.stringify
   * @ensures: data сохраняется с lastModified timestamp
   * @modifies: localStorage ключ 'andlanceros'
   * @throws: QuotaExceededError при переполнении
   * @why_ensures: lastModified критичен для отслеживания актуальности
   */
  save(data) {
    // Реализация
  }
}
```

## Правила написания SAL-аннотаций

### 1. Всегда для публичных методов

✅ **Правильно**: Публичные методы имеют SAL-аннотации
❌ **Неправильно**: Только некоторые методы аннотированы

### 2. Контракты точные

✅ **Правильно**: `@requires: pid валиден, ProcessManager имеет процесс`
❌ **Неправильно**: `@requires: параметры валидны`

### 3. Бизнесовое обоснование обязательно

✅ **Правильно**: `@why_ensures: События позволяют UI обновляться`
❌ **Неправильно**: Без @why_* тегов

### 4. Соответствие реализации

✅ **Правильно**: Контракты соответствуют коду
❌ **Неправильно**: Контракты не соответствуют реализации

## Проверка SAL-аннотаций

### Чек-лист для разработчика

- [ ] Все публичные методы аннотированы
- [ ] @requires проверяются в коде
- [ ] @ensures выполняются после выполнения
- [ ] @invariant поддерживаются
- [ ] Есть бизнесовое обоснование

### Чек-лист для ревьювера

- [ ] Контракты точные и конкретные
- [ ] Контракты соответствуют коду
- [ ] Бизнесовое обоснование понятно
- [ ] Нет противоречий между контрактами

## Обновление SAL-аннотаций

### Когда обновлять

✅ **Обязательно при:**
- Изменении сигнатуры метода
- Изменении поведения метода
- Добавлении новых зависимостей
- Изменении контрактов

❌ **Не нужно при:**
- Рефакторинге без изменения контрактов
- Исправлении багов без изменения API
- Изменении реализации без изменения поведения

## Интеграция с knowledge graphs

SAL-аннотации дополняют knowledge graphs:

- **Knowledge graphs** - высокоуровневая информация о модулях
- **SAL-аннотации** - детальные контракты в коде

Оба должны быть синхронизированы!
