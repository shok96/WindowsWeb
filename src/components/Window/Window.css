.window {
  position: absolute;
  background: var(--bg-secondary);
  border-radius: var(--border-radius);
  box-shadow: var(--shadow-large);
  display: flex;
  flex-direction: column;
  /* Убираем transform из transition для "резкости" */
  transition: opacity 0.2s ease-out; 
  border: 1px solid var(--border-primary); /* Добавляем рамку для ресайза */
  overflow: hidden; /* Обеспечиваем скругление углов у дочерних элементов */
}

/* Возвращаем transition когда окно не перемещается активно */
.window:not(.interacting) {
    transition: opacity 0.2s ease-out, transform 0.2s ease-out, width 0.2s ease-out, height 0.2s ease-out;
}


.window.focused {
  box-shadow: 0 8px 40px rgba(0, 0, 0, 0.3);
}

.window.maximized {
  border-radius: 0 !important;
  border: none !important;
}

.window.minimized {
  display: none;
}

.window.hidden {
  display: none;
}

.window-titlebar {
  height: 32px;
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border-primary);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 12px;
  cursor: move;
  user-select: none;
}

/* Cursors for resizing */
.window {
    /* Границы для ресайза */
    --resize-border: 6px;
    cursor: default;
    /* Указываем, какие области будут вызывать ресайз */
    touch-action: none; /* interact.js recommendation */
}
.window-titlebar {
    cursor: move;
    height: 38px; /* Увеличиваем высоту заголовка */
}

/* Динамические курсоры будут добавлены через JS/interact.js, но мы можем задать их явно */
.window[data-resize-edge="top"] { cursor: n-resize; }
.window[data-resize-edge="bottom"] { cursor: s-resize; }
.window[data-resize-edge="left"] { cursor: w-resize; }
.window[data-resize-edge="right"] { cursor: e-resize; }
.window[data-resize-edge="top-left"] { cursor: nw-resize; }
.window[data-resize-edge="top-right"] { cursor: ne-resize; }
.window[data-resize-edge="bottom-left"] { cursor: sw-resize; }
.window[data-resize-edge="bottom-right"] { cursor: se-resize; }


.window-title {
  font-size: 12px;
  font-weight: 600;
  color: var(--text-primary);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.window-controls {
  display: flex;
  gap: 12px;
  margin-left: auto;
}

.window-control {
  width: 46px; /* Увеличиваем ширину для соответствия Windows 10 */
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  cursor: pointer;
  color: var(--text-primary);
  transition: background-color 0.1s ease;
  border-radius: 0; /* Убираем скругление */
}

.window-control:hover {
  background-color: rgba(255, 255, 255, 0.1); /* Светло-серый фон */
}

.window-control.close:hover {
  background-color: #e81123; /* Ярко-красный фон */
  color: white;
}

.window-control svg {
  width: 12px;
  height: 12px;
}

.window-content {
  flex: 1;
  overflow: hidden; /* Убираем скролл из window-content */
  background: var(--bg-secondary);
  min-height: 0; /* Важно для flex-контейнеров */
  display: flex; /* Для корректной работы flex-приложений внутри */
  flex-direction: column;
}

/* If the app has its own scroll management, ensure it fills the space */
.window-content > .settings-app,
.window-content > .tm-app {
    overflow: hidden;
    flex: 1;
    min-height: 0;
}

/* If an app doesn't have its own scroll, ensure it takes up space and can scroll */
.window-content > *:not(.settings-app):not(.tm-app) {
  flex: 1;
  min-height: 0;
}

/* --- Mobile Responsive --- */
@media (max-width: 768px) {
  /* On mobile, all windows are fullscreen */
  .window, .window.maximized {
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: calc(100vh - 56px) !important; /* Full height minus mobile taskbar */
    transform: none !important;
    border-radius: 0 !important;
    border: none !important;
    transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
  }

  /* Slide in from bottom */
  .window:not(.visible) {
      transform: translateY(100%) !important;
  }
   .window.visible {
      transform: translateY(0) !important;
  }

  .window-titlebar {
    height: 44px; /* Taller for easier touch */
    padding: 0 8px;
  }

  /* Hide minimize and maximize buttons on mobile */
  .window-control.minimize,
  .window-control.maximize {
    display: none;
  }

  .window-control {
    width: 44px;
    height: 44px;
  }
  
  .window-content {
    /* Enable momentum scrolling on iOS */
    -webkit-overflow-scrolling: touch;
  }
}

